'use strict';
var childProcess = require('child_process');

exports.get = function (cb) {
	if (process.platform !== 'linux') {
		throw new Error('Only Linux systems are supported');
	}

	childProcess.exec('amixer get PCM', function (err, res) {
		if (err) {
			cb(err);
			return;
		}

		var matches = res.match(/Mono:\sPlayback\s([-0-9]{1,8})\s\[([0-9]{1,4})%\]\s\[([0-9.-]{1,7})dB]/);

		if(matches === null){
			throw new Error('Could not get the volume');
		}

		cb(null,parseInt(matches[2], 10));
	});
};

exports.set = function (level, cb) {
	if (process.platform !== 'linux') {
		throw new Error('Only Linux systems are supported');
	}

	if (typeof level !== 'number') {
		throw new TypeError('Expected a number');
	}

	if (level < 0 || level > 100) {
		cb(new Error('Expected a level between 0 and 1'));
		return;
	}

	childProcess.exec('amixer set PCM -- ' + level + '%', function (err, res) {
		if (err) {
			cb(err);
			return;
		}

		cb();
	});
};

